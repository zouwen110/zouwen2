(function(a){if(typeof exports=="object"||typeof exports==="function"&&typeof module=="object"){module.exports=a()}else{if(typeof define=="function"&&define.amd){return define([],a)}else{window.Pack=a()}}})(function(){var a=new Class(function(){this.object=new ActiveXObject("Adodb.Stream");this.fso=new ActiveXObject("Scripting.FileSystemObject");this.fileListInfo=""});a.add("doPack",function(e,f){this.object.Type=1;this.object.Mode=3;this.object.Open();this.object.Position=0;e=e.replace(/\\$/,"");var b=this.getFileList(e);if(b.length==0){return}this.fileListInfo=e.split("\\").reverse()[0]+"|"+this.fileListInfo.split(e+"\\").join("").replace(e,"");this.fileListInfo=this.fileListInfo.replace("||","|");this.setHeaderInfo(this.fileListInfo);for(var c=0;c<b.length;c++){var d=b[c].split(">")[0];this.AppendFile(d)}this.object.SaveToFile(f,2);this.object.Close();this.object=null});a.add("getFileList",function(b){b=b.replace(/\\$/,"");var d=fs(b,true).exist().dirs(function(f){return b+"\\"+f}).then().fail().stop().value();var e=this.fileList(b,function(f){return b+"\\"+f+">"+this.Size});if(e.length==0){this.fileListInfo+=b+"|"}else{this.fileListInfo+=e.join("|")+"|"}if(d.length!=0){for(var c=0;c<d.length;c++){e=e.concat(this.getFileList(d[c]))}}return e});a.add("fileList",function(e,h){var d=this.fso.GetFolder(e),c=d.Files,g=new Enumerator(c),f=[];for(;!g.atEnd();g.moveNext()){var b=g.item().Name;if(typeof h==="function"){b=h.call(g.item(),b);if(b){f.push(b)}}else{f.push(b)}}return f});a.add("AppendFile",function(d){var c=new ActiveXObject("Adodb.Stream"),b=d;c.Type=1;c.Mode=3;c.Open();c.LoadFromFile(b);this.object.Position=this.object.Size;if(c.Size!=0){this.object.Write(c.Read)}c.Close();c=null});a.add("setHeaderInfo",function(e){var b="00000000"+this.getStrSize(e).toString();var c="SPK "+b.substr(b.length-8)+" 00 "+e+" ";var d=new ActiveXObject("Adodb.Stream");d.Type=2;d.Open();d.Charset="utf-8";d.Position=0;d.WriteText=c;d.Position=3;d.CopyTo(this.object);d.Close();d=null});a.add("getStrSize",function(d){var c=new ActiveXObject("Adodb.Stream"),b;c.Type=2;c.Open();c.Charset="utf-8";c.Position=0;c.WriteText=d;b=c.Size-3;c.Close();c=null;return b});a.add("unPack",function(b,l){this.object.Type=1;this.object.Mode=3;this.object.Open();this.object.Position=0;this.object.LoadFromFile(b);this.binary=this.object.Read();l=l.replace(/\\$/,"");var n=this.getHeaderInfo(b),k=n.substr(0,8),g=n.substr(12);var h=g.split("|"),o=16+Number(k)+1;var m=l;this.autoCreateFolder(m);for(var f=1;f<h.length-1;f++){if(h[f].indexOf(">")==-1){this.autoCreateFolder(m+"\\"+h[f])}else{var j=h[f].split(">"),e=j[0],d=Number(j[1]),c=m+"\\"+e;this.autoCreateFolder(c.split("\\").slice(0,-1).join("\\"));if(d==0){this.fso.CreateTextFile(c,true)}else{this.SaveFile(o,d,c);o+=d}}}});a.add("getHeaderInfo",function(d){var c=new ActiveXObject("Adodb.Stream"),e;c.Type=2;c.Open();c.Charset="utf-8";c.LoadFromFile(d);c.Position=4+3;var b=Number(c.ReadText(8));c.Position=4+3;e=c.ReadText(12+b);c.Close();c=null;return e});a.add("SaveFile",function(f,b,d){var c=new ActiveXObject("Adodb.Stream"),e=d;c.Type=1;c.Mode=3;c.Open();this.object.Position=f;this.object.CopyTo(c,b);c.SaveToFile(e,2);c.Close();c=null});a.add("autoCreateFolder",function(e){var b=Server.MapPath("/"),f=e.replace(b,""),c=f.replace(/^\\/,"").split("\\");for(var d=0;d<c.length;d++){b+="\\"+c[d];if(!this.fso.FolderExists(b)){this.fso.CreateFolder(b)}}return this.fso.FolderExists(e)});return a});